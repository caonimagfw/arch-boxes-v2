# mke2fs.conf — CloudCone-compatible ext4 defaults.
#
# Purpose: CloudCone host GRUB (2.02-81.el8) does NOT support modern ext4
#          features: 64bit, metadata_csum, metadata_csum_seed, orphan_file.
#          By using MKE2FS_CONFIG to override the build host's mke2fs.conf,
#          we produce an ext4 filesystem identical to CloudCone's official
#          Debian 11 images, guaranteeing full GRUB compatibility.
#
# Reference: CloudCone Debian 11 filesystem (tune2fs -l /dev/vda1):
#   Filesystem features: has_journal ext_attr resize_inode dir_index filetype
#                        extent flex_bg sparse_super large_file huge_file
#                        uninit_bg dir_nlink extra_isize
#   Default directory hash: half_md4
#   Required extra isize:   28
#   Desired extra isize:    28
#   Inode size:             256
#   Block size:             4096
#   Flex block group size:  16
#
# Features explicitly EXCLUDED (not present on CloudCone Debian 11):
#   - metadata_csum      (GRUB 2.02 can't parse checksummed metadata)
#   - metadata_csum_seed (seed variant of above)
#   - 64bit              (GRUB 2.02 can't handle 64-bit block addressing)
#   - orphan_file        (e2fsprogs ≥1.47 feature, unknown to GRUB 2.02)
#
# Usage:   MKE2FS_CONFIG=debian11-mke2fs.conf mkfs.ext4 -F /dev/loopXp1

[defaults]
	base_features = sparse_super,large_file,filetype,resize_inode,dir_index,ext_attr
	default_mntopts = acl,user_xattr
	enable_periodic_fsck = 0
	blocksize = 4096
	inode_size = 256
	inode_ratio = 16384
	hash_alg = half_md4

[fs_types]
	ext3 = {
		features = has_journal
	}
	ext4 = {
		features = has_journal,extent,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize
		inode_size = 256
	}
	ext4dev = {
		features = has_journal,extent,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize
		inode_size = 256
	}
	small = {
		blocksize = 1024
		inode_size = 128
		inode_ratio = 4096
	}
	floppy = {
		blocksize = 1024
		inode_size = 128
		inode_ratio = 8192
	}
	big = {
		inode_ratio = 32768
	}
	huge = {
		inode_ratio = 65536
	}
	news = {
		inode_ratio = 4096
	}
	largefile = {
		inode_ratio = 1048576
	}
	largefile4 = {
		inode_ratio = 4194304
	}
	hurd = {
		blocksize = 4096
		inode_size = 128
	}
